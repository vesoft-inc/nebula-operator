## Coredump Preservation

To facilitate debugging in the event of a crash, Nebula Graph automatically preserves coredumps generated by all services (metad, graphd and storaged) when the coredump preservation feature is enabled. The coredumps are storged on a seperate volume generated by Nebula operator during cluster installation. You are able to specify the size of the generated volume and the amount of time the coredump should be kept before it is automatically deleted. 

### Prerequisites
* Nebula operator is installed
* Nebula operator version >= 1.8.2

### Using the Coredump Preservation Feature
The coredump preservation feature can be used by either installing the Nebula cluster using the provided helm chart in this repo or by adding the required values directly in your 
nebulacluster.yaml configuration. The steps for using each method are listed below.

#### 1. Using the Coredump Preservation Feature with the Provided Nebula Cluster Helm Chart:
The coredump preservation feature is enabled by default when installing with the provided Nebula cluster helm chart. The default values for the size of the generated volume and the amount of
time the coredump is kept is 5Gi and 72h respectively. To use this feature with the default values simply install Nebula cluster with the provided helm chart following the instructions [here](nebula_cluster_guide.md). To customize the values, look for the `coredumpPreservation:` section under `nebula` in the [values.yaml](https://raw.githubusercontent.com/vesoft-inc/nebula-operator/refs/heads/master/charts/nebula-cluster/values.yaml) file of the helm chart and modify the values below.
```yaml
nebula:
  coredumpPreservation:
    # Maximum time for the coredump to be kept on the seperate coredump volume
    # before being automatically deleted.
    maxTimeKept: 72h
    # wheather to enable the coredump preservation feature
    enable: true
    # Size of the coredump volume
    volumeSize: 5Gi
```

#### 2. Using the Coredump Preservation Feature Directly in Your Nebulacluster.yaml Configuration:
To enable the coredump preservation feature, please add the following parameters to your nebulacluster.yaml file before running `kubectl apply`.
```yaml
spec:
  coredumpPreservation:
    # Maximum time for the coredump to be kept on the seperate coredump volume
    # before being automatically deleted.
    maxTimeKept: 72h
    # Specs for the coredump volume 
    volumeSpecs:
      resources:
        requests:
          # Size of the coredump volume
          storage: 5Gi
```
